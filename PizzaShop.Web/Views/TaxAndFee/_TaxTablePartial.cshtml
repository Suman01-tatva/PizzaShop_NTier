@model List<PizzaShop.Entity.Data.TaxesAndFee>;

<div class="table-responsive mt-3 rounded shadow p-2 bg-white">
    <table class="table" id="tbl">
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>IsEnabled</th>
                <th>Default</th>
                <th>TaxValue</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var tax in Model)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => tax.Name)</td>
                    <td>
                        @if (tax.Type == true)
                        {
                            <p style="margin: 0;">Percentage</p>
                        }
                        else
                        {
                            <p style="margin: 0;">Flat Amount</p>
                        }
                    </td>
                    <td>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked"
                                   @(tax.IsActive == true ? "checked" : "")>
                        </div>
                    </td>
                    <td>
                        <div class="form-check form-switch">
                            <input class="form-check-input isDefaultSwitch" type="checkbox" id="flexSwitchCheckChecked"
                                   @(tax.IsDefault == true ? "checked" : "")>
                        </div>
                    </td>
                    <td>
                        @if (tax.Type == true)
                        {
                            @Html.DisplayFor(modelItem => tax.TaxValue)
                            <span>%</span>
                        }
                        else
                        {
                            <span>â‚¹</span>
                            @Html.DisplayFor(modelItem => tax.TaxValue)
                        }
                    </td>
                    <td>
                        <a href="javascript:void(0);" style="text-decoration: none; color: inherit;"
                           class="edit-tax" data-id="@tax.Id">
                            <i class="fa-solid fa-pen-clip m-1"></i>
                        </a>
                        @* <a href="javascript:void(0)" onclick="confirmDelete(@tax.Id)"
                           style="text-decoration: none; color: inherit;">
                            <i class="fa-solid fa-trash m-1"></i>
                        </a> *@
                        <a href="javascript:void(0);" class="delete-btn" data-id="@tax.Id">
                            <i class="fa-solid fa-trash m-1"></i>
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
    <script>
        $(document).ready(function () {
    $(document).on('change', '.isDefaultSwitch', function () {
        var checkbox = $(this);
        var taxId = checkbox.closest('tr').find('.edit-tax').data('id');
        
        // Determine if this is for IsActive or IsDefault
        var isActiveCheckbox = checkbox.closest('td').prev().find('.form-check-input'); // Previous column
        var isDefaultCheckbox = checkbox.closest('td').find('.form-check-input'); // Current column
        
        var isActive = isActiveCheckbox.is(':checked');
        var isDefault = isDefaultCheckbox.is(':checked');

        $.ajax({
            type: "POST",
            url: "/TaxAndFee/UpdateStatus",
            data: {
                id: taxId,
                isActive: isActive,
                isDefault: isDefault
            },
            success: function (response) {
                if (response.success) {
                    toastr.success(response.message);
                } else {
                    toastr.error(response.message);
                }
            },
            error: function (xhr, status, error) {
                toastr.error("Failed to update status.");
                console.error("Error details:", status, error, xhr.responseText);
            }
        });
    });
});

    </script>
