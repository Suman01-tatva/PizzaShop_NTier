@model PizzaShop.Entity.ViewModels.MenuViewModel

@{
  ViewData["Title"] = "Menu";
}

<!-- Main Content -->
<div class="col-12">
  <!-- menu header -->
  <h1 class="title">Menu</h1>

  <!-- Menu content -->
  <section class="p-3">
    <nav class="p-2 bg-white">
      <div class="nav nav-underline" id="nav-tab" role="tablist">
        <button class="nav-link active tab-link pe-1" id="nav-item-tab" data-bs-toggle="tab" data-bs-target="#nav-item"
          type="button" role="tab" aria-controls="nav-item" aria-selected="true">
          <span class="mx-2"><i class="fa-solid fa-list"></i> Items</span>
        </button>
        <button class="nav-link tab-link pe-2" id="nav-modifier-tab" data-bs-toggle="tab" data-bs-target="#nav-modifier"
          type="button" role="tab" aria-controls="nav-modifier" aria-selected="false">
          <img src="~/images/icons/ui-checks-grid.svg" alt="Modifier-icon" />
          Modifiers
        </button>
      </div>
    </nav>

    <!-- Items and Modifiers -->
    <div class="tab-content" id="nav-tabContent">
      <!-- Item Tab -->
      <div class="tab-pane fade show active mt-2" id="nav-item" role="tabpanel" aria-labelledby="nav-item-tab">
        @Html.Partial("_ItemTab", Model.ItemTab)
      </div>
      <!-- Modifier Tab -->
      <div class="tab-pane fade mt-2" id="nav-modifier" role="tabpanel" aria-labelledby="nav-modifier-tab">
        @Html.Partial("_ModifierTab", Model.ModifierTab)
      </div>
    </div>

    <!-- AddNewCategory Modal -->
    <div class="modal" id="addCategoryModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Add New Category</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <form id="addNewCategoryForm">
              <div class="form-group">
                <label for="categoryName">Category Name:</label>
                <input type="text" class="form-control" id="categoryName" name="Name" required>
              </div>
              <div class="form-group">
                <label for="categoryDescription">Category Description:</label>
                <input type="text" class="form-control" id="categoryDescription" name="Description" required>
              </div>
              <button type="submit" class="btn btn-primary">Add Category</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Category Modal -->
    <div class="modal fade" id="EditCategoryModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" id="editCategoryModalContent">
          <!-- The content of the modal will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Delete Category Modal -->
    <div class="modal fade" id="deleteCategoryModal" tabindex="-1" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Delete Confirmation</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="text-center">
            <i class="fa-solid fa-triangle-exclamation fa-2xl" style="color: #FFD43B;"></i>
          </div>
          <div class="modal-body text-center p-1">
            <p class="fw-bold mb-0">Are you sure you want to delete this Category?</p>
          </div>
          <div class="modal-footer d-flex justify-content-center border-0">
            <button type="button" class="fill-btn" id="confirmDeleteCategoryItemBtn">Yes</button>
            <button type="button" class="outline-btn" data-bs-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

@section Scripts {
  @* ItemTab Scripts *@
  <script>
    $(document).ready(function () {
      $('.edit-category').click(function () {
        var categoryId = $(this).data("id");
        $.ajax({
          url: '/Menu/EditCategory',
          type: 'GET',
          data: { id: categoryId },
          success: function (response) {
            $("#editCategoryModalContent").html(response);
            $("#EditCategoryModal").modal('show');
          },
          error: function (xhr, status, error) {
            alert("An error occurred while fetching the category details. Please try again.");
          }
        });
      });

      $(document).on('click', '#saveCategoryBtn', function () {
        var form = $('#editCategoryForm');
        var formData = form.serialize();

        $.ajax({
          type: "POST",
          url: '/Menu/EditCategory',
          data: formData,
          success: function (response) {
            if (response.success) {
              @* GetFilteredCategory(); *@
                $('#EditCategoryModal').modal('hide');
              window.location.href = response.redirectUrl;
            } else {
              alert(response.message);
            }
          },
          error: function (xhr, status, error) {
            alert("An error occurred while updating the category. Please try again.");
          }
        });
      });

      $(document).on('click', '.delete-category', function () {
        categoryIdToDelete = $(this).data("id");
        $('#deleteCategoryModal').modal('show');
      });

      $('#confirmDeleteCategoryItemBtn').click(function () {
        $.ajax({
          type: "POST",
          url: '/Menu/DeleteCategory',
          data: { id: categoryIdToDelete },
          success: function (response) {
            if (response.success) {
              $('#deleteCategoryModal').modal('hide');
              toastr.success(response.message);
                window.location.reload(); // Reload the page to show the updated category
              @* GetFilteredCategory(); *@
                    } else {
              alert(response.message);
            }
          },
          error: function (xhr, status, error) {
            alert("An error occurred while deleting the category. Please try again.");
          }
        });
      });
    });

    function GetFilteredCategory() {
      console.log("filter Category");
      $.ajax({
        url: "/Menu/GetAllCategory",
        type: "GET",
        data: {},
        success: function (data) {
          $(".category-list").html(data);
        }
      })
    }
  </script>
}